<Page
    x:Class="YouTube.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:YouTube"
    xmlns:converters="using:YouTube.Converters"
    mc:Ignorable="d"
    Background="Black">

    <Page.Resources>
        <converters:AspectRatioConverter x:Key="AspectRatioConverter"/>
        <Style x:Key="RoundedTextBoxStyle" TargetType="TextBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <Border x:Name="BorderElement"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="12">
                                <ScrollViewer x:Name="ContentElement"
                                            Margin="{TemplateBinding Padding}"
                                            HorizontalScrollMode="{TemplateBinding ScrollViewer.HorizontalScrollMode}"
                                            VerticalScrollMode="{TemplateBinding ScrollViewer.VerticalScrollMode}"
                                            HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}"
                                            VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}"
                                            IsHorizontalRailEnabled="{TemplateBinding ScrollViewer.IsHorizontalRailEnabled}"
                                            IsVerticalRailEnabled="{TemplateBinding ScrollViewer.IsVerticalRailEnabled}"
                                            IsDeferredScrollingEnabled="{TemplateBinding ScrollViewer.IsDeferredScrollingEnabled}"
                                            AutomationProperties.AccessibilityView="Raw"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TopBar: YouTube logo and search icon -->
        <Grid x:Name="TopBar" Grid.Row="0" Background="Black" Height="56" VerticalAlignment="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Image x:Name="YouTubeLogo" Source="Assets/ytlogo.png" Height="32" Margin="16,0,0,0" VerticalAlignment="Center"/>
            <Button x:Name="ShowSearchButton" Grid.Column="2" Background="Transparent" BorderThickness="0" Click="ShowSearchButton_Click" VerticalAlignment="Center" Margin="0,0,16,0">
                <Image Source="Assets/search.png" Width="24" Height="24"/>
            </Button>
        </Grid>

        <!-- Search box (hidden by default) -->
        <Grid x:Name="SearchPanel" Grid.Row="0" Margin="0,0,0,0" Background="#FF333333" Padding="5" Visibility="Collapsed">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBox x:Name="SearchInput" 
                         Grid.Row="0"
                         PlaceholderText="Search videos..."
                         Background="#FF222222"
                         BorderThickness="0"
                         Foreground="White"
                         Padding="10,5"
                         Style="{StaticResource RoundedTextBoxStyle}"
                         KeyUp="SearchInput_KeyUp"
                         TextChanged="SearchInput_TextChanged"/>
            </Grid>
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Button x:Name="SearchButton" Background="Transparent" Foreground="White" BorderThickness="0" Click="SearchButton_Click">
                    <Image Source="Assets/search.png" Width="24" Height="24"/>
                </Button>
                <Button x:Name="CloseSearchButton" Background="Transparent" Foreground="White" BorderThickness="0" Click="CloseSearchButton_Click" Margin="8,0,0,0">
                    <FontIcon Glyph="&#xE711;" FontFamily="Segoe MDL2 Assets" Width="24" Height="24"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Suggestions overlay (covers all, hidden by default) -->
        <Grid x:Name="SuggestionsOverlay" Background="#FF222222" Visibility="Collapsed" Grid.RowSpan="4" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" >
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <!-- Верхняя панель поиска -->
            <Grid Grid.Row="0" Background="#222" Height="56" VerticalAlignment="Top">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button x:Name="SuggestionsBackButton" Grid.Column="0" Background="Transparent" BorderThickness="0" Click="CloseSearchButton_Click" VerticalAlignment="Center" Margin="8,0,0,0">
                    <FontIcon Glyph="&#xE72B;" FontFamily="Segoe MDL2 Assets" Foreground="White" FontSize="24"/>
                </Button>
                <TextBox x:Name="SearchInputOverlay" Grid.Column="1"
                         PlaceholderText="Поиск"
                         Background="#333"
                         BorderThickness="0"
                         Foreground="White"
                         Padding="10,5"
                         Style="{StaticResource RoundedTextBoxStyle}"
                         KeyUp="SearchInput_KeyUp"
                         TextChanged="SearchInput_TextChanged"
                         VerticalAlignment="Center"
                         FontSize="18"/>
                <Button x:Name="SearchButtonOverlay" Grid.Column="2" Background="Transparent" Foreground="White" BorderThickness="0" Click="SearchButton_Click" VerticalAlignment="Center" Margin="0,0,8,0">
                    <Image Source="Assets/search.png" Width="24" Height="24"/>
                </Button>
            </Grid>
            <!-- Список предложений -->
            <ListBox x:Name="SuggestionsListBox" Grid.Row="1" Background="Transparent" Foreground="White" BorderThickness="0" SelectionChanged="SearchSuggestionsList_SelectionChanged">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="56" Margin="0,0,0,0">
                            <TextBlock Text="{Binding}" VerticalAlignment="Center" FontSize="16" Margin="16,0"/>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>

        <!-- Categories ScrollViewer -->
        <ScrollViewer x:Name="CategoriesScrollViewer" 
                     Grid.Row="1" 
                     HorizontalScrollMode="Enabled"
                     HorizontalScrollBarVisibility="Auto"
                     VerticalScrollMode="Disabled"
                     VerticalScrollBarVisibility="Disabled"
                     Margin="0,0,0,10">
            <ItemsControl x:Name="CategoriesContainer">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="CategoryBorder"
                                Background="#FF333333"
                                CornerRadius="0"
                                Margin="5,0">
                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Click="CategoryButton_Click"
                                    Padding="15,8"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch">
                                <TextBlock Text="{Binding title}"
                                          Foreground="White"
                                          FontSize="14"/>
                            </Button>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Main content area -->
        <Grid Grid.Row="2">
            <!-- Video list view -->
            <Grid x:Name="VideoListView" Visibility="Visible">
                <ScrollViewer x:Name="VideoListViewScrollViewer" Visibility="Visible">
                <StackPanel>
                    <ItemsControl x:Name="VideosContainer" HorizontalAlignment="Center">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsWrapGrid Orientation="Horizontal" 
                                             MaximumRowsOrColumns="3"
                                             HorizontalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Margin" Value="8"/>
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button HorizontalAlignment="Stretch"
                                        Padding="0"
                                        Click="VideoCard_Click"
                                        Background="Transparent">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Thumbnail Container with rounded corners -->
                                            <Border CornerRadius="12" Grid.Row="0"
                                                    Background="Black">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Rectangle Fill="Black">
                                                        <Rectangle.Height>
                                                            <Binding Path="ActualWidth" 
                                                                     RelativeSource="{RelativeSource Self}" 
                                                                     Converter="{StaticResource AspectRatioConverter}" 
                                                                     ConverterParameter="0.5625"/>
                                                        </Rectangle.Height>
                                                    </Rectangle>
                                            <Image Source="{Binding Thumbnail}"
                                                           Stretch="Uniform"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                            </Border>

                                            <!-- Video info -->
                                            <Grid Grid.Row="1" Margin="0,12,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Channel Avatar -->
                                                <Border Width="36" 
                                                        Height="36" 
                                                        CornerRadius="18" 
                                                        Margin="0,0,12,0"
                                                        Background="Black"
                                                        VerticalAlignment="Top">
                                                    <Image Source="{Binding ChannelThumbnail}"
                                                           Stretch="UniformToFill"
                                                           Tapped="CardAuthor_Tapped"/>
                                                </Border>

                                                <!-- Title and Channel Info -->
                                                <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                                <TextBlock Text="{Binding Title}"
                                                          TextWrapping="Wrap"
                                                          FontSize="14"
                                                              LineHeight="20"
                                                          Foreground="White"
                                                              MaxLines="2"
                                                          TextTrimming="CharacterEllipsis"
                                                          Tapped="CardAuthor_Tapped"/>

                                                    <TextBlock Text="{Binding Author}"
                                                              FontSize="12"
                                                              Foreground="#AAAAAA"
                                                              Margin="0,4,0,0"
                                                              TextTrimming="CharacterEllipsis"
                                                              Tapped="CardAuthor_Tapped"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>

                <ProgressRing x:Name="VideoListLoadingRing"
                            IsActive="False"
                            Width="50"
                            Height="50"
                            Foreground="White"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Canvas.ZIndex="1"/>
            </Grid>

            <!-- Video Player View -->
            <Grid x:Name="VideoPlayerView" Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" x:Name="PlayerColumn"/>
                    <ColumnDefinition Width="400" x:Name="RelatedColumn"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Левая часть: плеер, инфо, описание -->
                <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="PlayerInfoPanel" Margin="24,0,12,0">
                        <Grid x:Name="VideoPlayerContainer">
                            <MediaPlayerElement x:Name="VideoPlayer" 
                                             AreTransportControlsEnabled="True"
                                             Height="300"
                                             DoubleTapped="VideoPlayer_DoubleTapped">
                                <MediaPlayerElement.TransportControls>
                                    <MediaTransportControls IsCompact="False"
                                                          IsFullWindowButtonVisible="True"
                                                          IsZoomButtonVisible="True"
                                                          IsPlaybackRateButtonVisible="True"
                                                          IsVolumeButtonVisible="True"
                                                          IsSeekBarVisible="True"
                                                          IsFullWindowEnabled="True"
                                                          IsZoomEnabled="True"
                                                          IsPlaybackRateEnabled="True"
                                                          IsVolumeEnabled="True"
                                                          IsSeekEnabled="True"/>
                                </MediaPlayerElement.TransportControls>
                            </MediaPlayerElement>
                            <Grid x:Name="SkipOverlay" Visibility="Collapsed" Background="#80000000">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <FontIcon x:Name="SkipIcon" Glyph="&#xE111;" FontFamily="Segoe MDL2 Assets" FontSize="48" Foreground="White"/>
                                    <TextBlock x:Name="SkipText" Text="10 seconds" Foreground="White" FontSize="24" Margin="10,0,0,0"/>
                                </StackPanel>
                            </Grid>
                        </Grid>

                        <ProgressRing x:Name="VideoInfoLoadingRing" IsActive="False" Visibility="Collapsed"/>
                        <TextBlock x:Name="VideoTitleText" Style="{StaticResource TitleTextBlockStyle}" TextWrapping="Wrap" Foreground="White"/>
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <Border x:Name="ChannelPicture" Width="40" Height="40" Background="#333333" Tapped="ChannelPicture_Tapped">
                                <Image x:Name="ChannelImage" Stretch="UniformToFill"/>
                            </Border>
                            <StackPanel Margin="10,0,0,0">
                                <TextBlock x:Name="VideoAuthorText" Style="{StaticResource SubtitleTextBlockStyle}" Foreground="White"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock x:Name="VideoViewsText" Foreground="White"/>
                                    <TextBlock Text=" • " Margin="10,0" Foreground="White"/>
                                    <TextBlock x:Name="VideoUploadDateText" Foreground="White"/>
                                    <Border x:Name="LikesPanel" 
                                            Background="#272727" 
                                            Padding="10,5" 
                                            Margin="10,0,0,0">
                                        <StackPanel Orientation="Horizontal">
                                            <SymbolIcon Symbol="Like" Foreground="White"/>
                                            <TextBlock x:Name="VideoLikesText" Margin="5,0,0,0" Foreground="White"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                        <Border x:Name="DescriptionBorder"
                                Background="#272727"
                                Margin="0,10,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <ScrollViewer x:Name="DescriptionScrollViewer" 
                                              Height="200"
                                              VerticalScrollBarVisibility="Auto"
                                              Padding="12">
                                    <TextBlock x:Name="VideoDescriptionText" 
                                               TextWrapping="Wrap"
                                               Foreground="White"/>
                                </ScrollViewer>
                                <Button x:Name="ToggleDescriptionButton"
                                        Grid.Row="1"
                                        Content="Show More"
                                        Click="ToggleDescriptionButton_Click"
                                        HorizontalAlignment="Center"
                                        Margin="0,8,0,8"
                                        Background="Transparent"
                                        Foreground="White"/>
                            </Grid>
                        </Border>
                        <!-- Рекомендации для портретного режима -->
                        <StackPanel x:Name="RelatedPanelVertical" Visibility="Collapsed" Margin="0,20,0,0">
                            <TextBlock Text="Related Videos" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,10" Foreground="White"/>
                            <ItemsControl x:Name="RelatedVideosContainerVertical">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Click="VideoCard_Click" Padding="0" Background="Transparent" Margin="0,0,0,10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="180"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <Image Source="{Binding Thumbnail}" Stretch="UniformToFill" Height="100"/>
                                                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding Title}" TextWrapping="Wrap" MaxLines="2" Foreground="White"/>
                                                    <TextBlock Text="{Binding Author}" Opacity="0.7" Foreground="White"/>
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding Views}" Foreground="White"/>
                                                        <TextBlock Text=" • " Margin="10,0" Foreground="White"/>
                                                        <TextBlock Text="{Binding PublishedAt}" Foreground="White"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button x:Name="LoadMoreRelatedButtonVertical"
                                    Content="Загрузить ещё"
                                    HorizontalAlignment="Center"
                                    Margin="0,10,0,0"
                                    Padding="20,10"
                                    Background="#272727"
                                    Foreground="White"
                                    Click="LoadMoreRelated_Click"/>
                        </StackPanel>
                        <!-- Комментарии под описанием -->
                        <StackPanel x:Name="CommentsPanel" Margin="0,20,0,0" Visibility="Collapsed">
                            <TextBlock x:Name="CommentsHeader" Text="Комментарии" FontSize="18" FontWeight="Bold" Foreground="White"/>
                            <ItemsControl x:Name="CommentsList">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,10">
                                            <Border Width="36" Height="36" CornerRadius="18" Background="#333">
                                                <Image Source="{Binding AuthorThumbnail}" Stretch="UniformToFill"/>
                                            </Border>
                                            <StackPanel Margin="10,0,0,0">
                                                <TextBlock Text="{Binding Author}" Foreground="#AAA" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding PublishedAt}" Foreground="#666" FontSize="12"/>
                                                <TextBlock Text="{Binding Text}" Foreground="White" TextWrapping="Wrap" MaxWidth="600"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- Правая часть: рекомендации -->
                <ScrollViewer Grid.Column="1" Margin="12,0,24,0" x:Name="RelatedPanel" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Related Videos" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,10" Foreground="White"/>
                        <ItemsControl x:Name="RelatedVideosContainer">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Click="VideoCard_Click" Padding="0" Background="Transparent" Margin="0,0,0,10">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="180"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Image Source="{Binding Thumbnail}" Stretch="UniformToFill" Height="100"/>
                                            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                                <TextBlock Text="{Binding Title}" TextWrapping="Wrap" MaxLines="2" Foreground="White"/>
                                                <TextBlock Text="{Binding Author}" Opacity="0.7" Foreground="White"/>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Views}" Foreground="White"/>
                                                    <TextBlock Text=" • " Margin="10,0" Foreground="White"/>
                                                    <TextBlock Text="{Binding PublishedAt}" Foreground="White"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Button x:Name="LoadMoreRelatedButton"
                                Content="Загрузить ещё"
                                HorizontalAlignment="Center"
                                Margin="0,10,0,0"
                                Padding="20,10"
                                Background="#272727"
                                Foreground="White"
                                Click="LoadMoreRelated_Click"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- Settings view -->
            <Grid x:Name="SettingsView" Visibility="Collapsed" Margin="0,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Settings" 
                                 FontSize="24"
                           FontWeight="Bold" 
                           Margin="20,20,20,20"
                           Foreground="White"/>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20,0,20,20">
                        <TextBlock Text="API URL" 
                                   FontSize="16" 
                                   Margin="0,0,0,10"
                                   Foreground="White"/>
                        <TextBox x:Name="ApiUrlTextBox"
                                 PlaceholderText="Enter API URL" 
                                 Margin="0,0,0,20"
                                 Foreground="White"
                                 Background="#1A1A1A"
                                 BorderBrush="#333333"/>

                        <TextBlock Text="Default Quality" 
                                   FontSize="16" 
                                   Margin="0,0,0,10"
                                   Foreground="White"/>
                        <TextBox x:Name="QualityTextBox"
                                 PlaceholderText="Enter default quality" 
                                 Margin="0,0,0,20"
                                 Foreground="White"
                                 Background="#1A1A1A"
                                 BorderBrush="#333333"/>

                        <TextBlock Text="YouTube API Key" 
                                   FontSize="16" 
                                   Margin="0,0,0,10"
                                   Foreground="White"/>
                        <TextBox x:Name="YoutubeApiKeyTextBox"
                                 PlaceholderText="Enter YouTube API Key" 
                                 Margin="0,0,0,20"
                                 Foreground="White"
                                 Background="#1A1A1A"
                                 BorderBrush="#333333"/>

                        <ToggleSwitch x:Name="RoundedCornersToggle"
                                      Header="Use Rounded Corners"
                                      OnContent="Enabled"
                                      OffContent="Disabled"
                                    Margin="0,0,0,20"
                                      Foreground="White"/>

                        <Button x:Name="SaveSettingsButton" 
                                Content="Save Settings" 
                                Click="SaveSettings_Click"
                                Background="#1A1A1A"
                                BorderBrush="#333333"
                                Foreground="White"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- History view -->
            <Grid x:Name="HistoryView" Visibility="Collapsed">
                <ScrollViewer>
                    <StackPanel>
                        <TextBlock Text="История просмотров"
                                  FontSize="24"
                                  FontWeight="Bold"
                                  Margin="20,20,20,20"
                                  Foreground="White"/>
                                  
                        <ItemsControl x:Name="HistoryContainer">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <ItemsWrapGrid Orientation="Horizontal" 
                                                 MaximumRowsOrColumns="3"
                                                 HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Margin" Value="8"/>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button HorizontalAlignment="Stretch"
                                            Padding="0"
                                            Click="VideoCard_Click"
                                            Background="Transparent">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Thumbnail Container with rounded corners -->
                                            <Border CornerRadius="12" Grid.Row="0"
                                                    Background="Black">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Rectangle Fill="Black">
                                                        <Rectangle.Height>
                                                            <Binding Path="ActualWidth" 
                                                                     RelativeSource="{RelativeSource Self}" 
                                                                     Converter="{StaticResource AspectRatioConverter}" 
                                                                     ConverterParameter="0.5625"/>
                                                        </Rectangle.Height>
                                                    </Rectangle>
                                                    <Image Source="{Binding Thumbnail}"
                                                           Stretch="Uniform"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>

                                            <!-- Video info -->
                                            <Grid Grid.Row="1" Margin="0,12,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Channel Avatar -->
                                                <Border Width="36" 
                                                        Height="36" 
                                                        CornerRadius="18" 
                                                        Margin="0,0,12,0"
                                                        Background="Black"
                                                        VerticalAlignment="Top">
                                                    <Image Source="{Binding ChannelThumbnail}"
                                                           Stretch="UniformToFill"
                                                           Tapped="CardAuthor_Tapped"/>
                                                </Border>

                                                <!-- Title and Channel Info -->
                                                <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                                    <TextBlock Text="{Binding Title}"
                                                              TextWrapping="Wrap"
                                                              FontSize="14"
                                                              LineHeight="20"
                                                              Foreground="White"
                                                              MaxLines="2"
                                                              TextTrimming="CharacterEllipsis"
                                                              Tapped="CardAuthor_Tapped"/>

                                                    <TextBlock Text="{Binding Author}"
                                                              FontSize="12"
                                                              Foreground="#AAAAAA"
                                                              Margin="0,4,0,0"
                                                              TextTrimming="CharacterEllipsis"
                                                              Tapped="CardAuthor_Tapped"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- Author (Channel) view -->
            <Grid x:Name="AuthorView" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <ScrollViewer>
                    <StackPanel>
                        <!-- Banner -->
                        <Border Height="180" Background="#222">
                            <Image x:Name="AuthorBanner" Stretch="UniformToFill"/>
                        </Border>
                        <!-- Информация об авторе -->
                        <StackPanel Orientation="Horizontal" Margin="32,-48,0,0" VerticalAlignment="Top">
                            <Border Width="96" Height="96" CornerRadius="0" BorderBrush="#222" BorderThickness="4" Background="#222">
                                <Image x:Name="AuthorAvatar" Stretch="UniformToFill"/>
                            </Border>
                            <StackPanel Margin="24,24,0,0" VerticalAlignment="Bottom">
                                <TextBlock x:Name="AuthorTitle" FontSize="28" FontWeight="Bold" Foreground="White"/>
                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <TextBlock x:Name="AuthorSubscribers" Foreground="#AAA" FontSize="14"/>
                                    <TextBlock Text=" • " Foreground="#AAA" FontSize="14" Margin="8,0"/>
                                    <TextBlock x:Name="AuthorVideosCount" Foreground="#AAA" FontSize="14"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                        <!-- Видео автора -->
                        <ItemsControl x:Name="AuthorVideosContainer">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="3" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Margin" Value="8"/>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button HorizontalAlignment="Stretch"
                                            Padding="0"
                                            Click="AuthorVideoCard_Click"
                                            Background="Transparent">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <!-- Thumbnail -->
                                            <Border CornerRadius="12" Grid.Row="0" Background="Black">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Rectangle Fill="Black">
                                                        <Rectangle.Height>
                                                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}" Converter="{StaticResource AspectRatioConverter}" ConverterParameter="0.5625"/>
                                                        </Rectangle.Height>
                                                    </Rectangle>
                                                    <Image Source="{Binding Thumbnail}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                            <!-- Video info -->
                                            <Grid Grid.Row="1" Margin="0,12,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <!-- Channel Avatar -->
                                                <Border Width="36" Height="36" CornerRadius="18" Margin="0,0,12,0" Background="Black" VerticalAlignment="Top">
                                                    <Image Source="{Binding ChannelThumbnail}" Stretch="UniformToFill" Tapped="CardAuthor_Tapped"/>
                                                </Border>
                                                <!-- Title and Channel Info -->
                                                <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                                    <TextBlock Text="{Binding Title}" TextWrapping="Wrap" FontSize="14" LineHeight="20" Foreground="White" MaxLines="2" TextTrimming="CharacterEllipsis" Tapped="CardAuthor_Tapped"/>
                                                    <TextBlock Text="{Binding Author}" FontSize="12" Foreground="#AAAAAA" Margin="0,4,0,0" TextTrimming="CharacterEllipsis" Tapped="CardAuthor_Tapped"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>

        <!-- Bottom TabBar -->
        <Grid Grid.Row="3" Background="#FF222222" Height="60">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Home -->
            <Button Grid.Column="0" 
                    Background="Transparent" 
                    BorderThickness="0"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Click="HomeTab_Click">
                <StackPanel Orientation="Vertical" 
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE80F;" 
                     FontFamily="Segoe MDL2 Assets"
                     FontSize="20"
                     Foreground="White"/>
                    <TextBlock Text="Главная" 
                               Foreground="White" 
                               Margin="0,4,0,0"
                               FontSize="10"/>
                </StackPanel>
            </Button>

            <!-- Account -->
            <Button Grid.Column="1" 
                    Background="Transparent" 
                    BorderThickness="0"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    IsEnabled="False"
                    Opacity="0.5">
                <StackPanel Orientation="Vertical"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE77B;" 
                     FontFamily="Segoe MDL2 Assets"
                     FontSize="20"
                     Foreground="White"/>
                    <TextBlock Text="Аккаунт" 
                               Foreground="White" 
                               Margin="0,4,0,0"
                               FontSize="10"/>
                </StackPanel>
            </Button>

            <!-- History -->
            <Button Grid.Column="2" 
                    Background="Transparent" 
                    BorderThickness="0"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Click="HistoryTab_Click">
                <StackPanel Orientation="Vertical"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE81C;" 
                     FontFamily="Segoe MDL2 Assets"
                     FontSize="20"
                     Foreground="White"/>
                    <TextBlock Text="История" 
                               Foreground="White" 
                               Margin="0,4,0,0"
                               FontSize="10"/>
                </StackPanel>
            </Button>

            <!-- Settings -->
            <Button Grid.Column="3" 
                    Background="Transparent" 
                    BorderThickness="0"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Click="SettingsTab_Click">
                <StackPanel Orientation="Vertical"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE713;" 
                     FontFamily="Segoe MDL2 Assets"
                     FontSize="20"
                     Foreground="White"/>
                    <TextBlock Text="Настройки" 
                               Foreground="White" 
                               Margin="0,4,0,0"
                               FontSize="10"/>
                </StackPanel>
            </Button>
        </Grid>
    </Grid>
</Page>