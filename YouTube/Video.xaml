<Page
    x:Class="YouTube.Video"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:YouTube"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Black">

    <Grid Background="Black">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Navbar at the top -->
        <local:navbar x:Name="navbar" Grid.Row="0"/>

        <!-- Main content area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" x:Name="PlayerColumn"/>
                <ColumnDefinition Width="400" x:Name="RelatedColumn"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Left part: player, info, description -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Hidden">
                <StackPanel x:Name="PlayerInfoPanel" Margin="0">
                    <Grid x:Name="VideoPlayerContainer" Background="Black">
                        <MediaPlayerElement x:Name="VideoPlayer" 
                                           AreTransportControlsEnabled="True"
                                           Height="300"
                                           DoubleTapped="VideoPlayer_DoubleTapped"
                                           RequestedTheme="Dark"
                                           Background="Black">
                            <MediaPlayerElement.TransportControls>
                                <local:CustomMediaTransportControls/>
                            </MediaPlayerElement.TransportControls>
                        </MediaPlayerElement>
                        <Grid x:Name="SkipOverlay" Visibility="Collapsed" Background="#80000000" IsHitTestVisible="False">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <FontIcon x:Name="SkipIcon" Glyph="&#xE111;" FontFamily="Segoe MDL2 Assets" FontSize="48" Foreground="White"/>
                                <TextBlock x:Name="SkipText" Text="10 сек" Foreground="White" FontSize="24" Margin="10,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Grid>

                    <!-- 1. Название видео с отступами - сделано кликабельным -->
                    <Button x:Name="VideoInfoButton"
                            Click="VideoInfoButton_Click"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="0"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Stretch">
                        <StackPanel>
                            <TextBlock x:Name="VideoTitleText" 
                                       Text="Sample Video Title"
                                       FontSize="18" 
                                       FontWeight="SemiBold" 
                                       TextWrapping="Wrap" 
                                       Foreground="White"
                                       Margin="16,12,16,8"/>

                            <!-- 2. Информация о видео в одну строку -->
                            <StackPanel Orientation="Horizontal" Margin="16,0,16,12">
                                <TextBlock x:Name="VideoViewsText" 
                                           Text="1M просмотров" 
                                           Foreground="#AAAAAA" 
                                           FontSize="14"/>
                                <TextBlock Text="• " 
                                           Foreground="#AAAAAA" 
                                           FontSize="14" 
                                           Margin="6,0"/>
                                <TextBlock x:Name="VideoUploadDateText" 
                                           Text="1 день назад" 
                                           Foreground="#AAAAAA" 
                                           FontSize="14"/>
                                <TextBlock Text="  " 
                                           Foreground="#AAAAAA" 
                                           FontSize="14" 
                                           Margin="6,0"/>
                                <Button x:Name="ShowDescriptionButton"
                                        Content="Ещё"
                                        Click="ShowDescriptionButton_Click"
                                        Background="Transparent"
                                        Foreground="#AAAAAA"
                                        FontSize="14"
                                        Padding="0"
                                        BorderThickness="0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>

                    <!-- 3. Информация об авторе -->
                    <Grid Margin="16,0,16,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Channel avatar and info -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <Border x:Name="ChannelPicture" 
                                    Width="36" 
                                    Height="36" 
                                    CornerRadius="18" 
                                    Background="#333333" 
                                    Tapped="ChannelPicture_Tapped">
                                <Image x:Name="ChannelImage" Stretch="UniformToFill"/>
                            </Border>
                            <StackPanel Margin="12,0,0,0" VerticalAlignment="Center" Orientation="Horizontal">
                                <TextBlock x:Name="VideoAuthorText" 
                                           Text="Автор канала" 
                                           Foreground="White" 
                                           FontSize="15" 
                                           FontWeight="Medium"
                                           VerticalAlignment="Center"/>
                                <TextBlock x:Name="SubscriberCountText" 
                                           Text="1.2M" 
                                           Foreground="#AAAAAA" 
                                           FontSize="12"
                                           Margin="8,0,0,0"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Subscribe button aligned to right -->
                        <Border Grid.Column="2"
                                Background="#f1f1f1"
                                CornerRadius="2"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Right">
                            <Button x:Name="SubscribeButton"
                                    Content="Подписаться"
                                    Background="Transparent"
                                    Foreground="Black"
                                    FontSize="12"
                                    FontWeight="SemiBold"
                                    Padding="16,8"
                                    BorderThickness="0"
                                    IsEnabled="False"/>
                        </Border>
                    </Grid>

                    <!-- Кнопки лайк, дизлайк, поделиться -->
                    <StackPanel Orientation="Horizontal" Margin="16,8,16,16" HorizontalAlignment="Left">
                        <Border Background="#1a1a1a"
                                CornerRadius="18"
                                Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <Button x:Name="LikeButton"
                                        Click="LikeButton_Click"
                                        Background="Transparent"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="16,8,8,8">
                                    <StackPanel Orientation="Horizontal">
                                        <Image Source="Assets/player/like.png" Width="16" Height="16"/>
                                        <TextBlock x:Name="LikeCountText" 
                                                   Text="1.2K" 
                                                   Margin="6,0,0,0" 
                                                   FontSize="14"/>
                                    </StackPanel>
                                </Button>
                                <Rectangle Width="1" 
                                           Height="24" 
                                           Fill="#333333" 
                                           VerticalAlignment="Center"/>
                                <Button x:Name="DislikeButton"
                                        Background="Transparent"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="8,8,16,8"
                                        IsEnabled="False"
                                        Opacity="0.6">
                                    <Image Source="Assets/player/dislike.png" Width="16" Height="16"/>
                                </Button>
                            </StackPanel>
                        </Border>

                        <Border Background="#1a1a1a"
                                CornerRadius="18"
                                Margin="0,0,8,0">
                            <Button x:Name="ShareButton"
                                    Click="ShareButton_Click"
                                    Background="Transparent"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="16,8">
                                <StackPanel Orientation="Horizontal">
                                    <Image Source="Assets/player/send.png" Width="16" Height="16"/>
                                    <TextBlock Text="Поделиться" 
                                               Margin="6,0,0,0" 
                                               FontSize="14"/>
                                </StackPanel>
                            </Button>
                        </Border>
                    </StackPanel>

                    <!-- 4. Последний комментарий - сделан кликабельным -->
                    <Button x:Name="CommentsContainerButton"
                            Click="CommentsContainerButton_Click"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="0"
                            Margin="16,0,16,16"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Stretch"
                            Visibility="Collapsed">
                        <Border Background="#1A1A1A" 
                                CornerRadius="8" 
                                Padding="16"
                                x:Name="LastCommentContainer">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="Комментарии" 
                                               Foreground="White" 
                                               FontSize="15" 
                                               FontWeight="SemiBold"/>
                                    <TextBlock x:Name="CommentCountText" 
                                               Text="• 1,234" 
                                               Foreground="#AAAAAA" 
                                               FontSize="15" 
                                               Margin="8,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" x:Name="LastCommentPanel">
                                    <Border Width="24" Height="24" CornerRadius="12" Background="#333" Margin="0,0,8,0">
                                        <Image x:Name="LastCommentAuthorImage" Stretch="UniformToFill"/>
                                    </Border>
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock x:Name="LastCommentAuthor" 
                                                       Text="username" 
                                                       Foreground="#AAAAAA" 
                                                       FontSize="13"/>
                                            <TextBlock x:Name="LastCommentTime" 
                                                       Text="2 часа назад" 
                                                       Foreground="#666666" 
                                                       FontSize="13" 
                                                       Margin="8,0,0,0"/>
                                        </StackPanel>
                                        <TextBlock x:Name="LastCommentText" 
                                                   Text="Это отличное видео! Очень познавательно..." 
                                                   Foreground="White" 
                                                   FontSize="14" 
                                                   TextWrapping="Wrap" 
                                                   MaxLines="2"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Button>

                    <!-- 5. Рекомендации для портретного режима -->
                    <StackPanel x:Name="RelatedPanelVertical" Visibility="Collapsed" Margin="16,0,16,0">
                        <ProgressRing x:Name="RelatedVideosLoadingRingVertical" 
                                      IsActive="False" 
                                      Visibility="Collapsed"
                                      Height="40"
                                      Width="40"
                                      Margin="0,20,0,20"
                                      HorizontalAlignment="Center"/>
                        <ItemsControl x:Name="RelatedVideosContainerVertical">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Click="VideoCard_Click" 
                                            Padding="0" 
                                            Background="Transparent" 
                                            Margin="0,0,0,16"
                                            HorizontalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="168"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" 
                                                    CornerRadius="8" 
                                                    Background="#1A1A1A">
                                                <Grid>
                                                    <Image Source="{Binding Thumbnail}" 
                                                           Stretch="UniformToFill" 
                                                           Height="94"/>
                                                </Grid>
                                            </Border>
                                            <StackPanel Grid.Column="1" 
                                                        Margin="12,0,0,0" 
                                                        VerticalAlignment="Top">
                                                <TextBlock Text="{Binding Title}" 
                                                           TextWrapping="Wrap" 
                                                           MaxLines="2" 
                                                           Foreground="White"
                                                           FontSize="14"
                                                           FontWeight="Medium"
                                                           LineHeight="20"/>
                                                <TextBlock Text="{Binding Author}" 
                                                           Foreground="#AAAAAA" 
                                                           FontSize="13"
                                                           Margin="0,4,0,2"/>
                                                <TextBlock Foreground="#AAAAAA"
                                                           FontSize="13"
                                                           TextWrapping="NoWrap">
                                                    <Run Text="{Binding Views}"/>
                                                    <Run Text=" просмотров · "/>
                                                    <Run Text="{Binding PublishedAt}"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- Скрытая панель с полными комментариями -->
                    <StackPanel x:Name="CommentsPanel" Margin="0,20,0,0" Visibility="Collapsed">
                        <TextBlock x:Name="CommentsHeader" Text="Комментарии" FontSize="18" FontWeight="Bold" Foreground="White"/>
                        <ItemsControl x:Name="CommentsList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,10,0,10">
                                        <Border Width="36" Height="36" CornerRadius="18" Background="#333">
                                            <Image Source="{Binding AuthorThumbnail}" Stretch="UniformToFill"/>
                                        </Border>
                                        <StackPanel Margin="10,0,0,0">
                                            <TextBlock Text="{Binding Author}" Foreground="#AAA" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding PublishedAt}" Foreground="#666" FontSize="12"/>
                                            <TextBlock Text="{Binding Text}" Foreground="White" TextWrapping="Wrap" MaxWidth="600"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <!-- Right part: related videos -->
            <ScrollViewer Grid.Column="1" Margin="0" x:Name="RelatedPanel" VerticalScrollBarVisibility="Hidden">
                <StackPanel>
                    <ProgressRing x:Name="RelatedVideosLoadingRing" 
                                  IsActive="False" 
                                  Visibility="Collapsed"
                                  Height="40"
                                  Width="40"
                                  Margin="0,20,0,20"
                                  HorizontalAlignment="Center"/>
                    <ItemsControl x:Name="RelatedVideosContainer">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Click="VideoCard_Click" 
                                        Padding="0" 
                                        Background="Transparent" 
                                        Margin="16,0,16,16"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="168"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" 
                                                CornerRadius="8" 
                                                Background="#1A1A1A">
                                            <Grid>
                                                <Image Source="{Binding Thumbnail}" 
                                                       Stretch="UniformToFill" 
                                                       Height="94"/>
                                            </Grid>
                                        </Border>
                                        <StackPanel Grid.Column="1" 
                                                    Margin="12,0,0,0" 
                                                    VerticalAlignment="Top">
                                            <TextBlock Text="{Binding Title}" 
                                                       TextWrapping="Wrap" 
                                                       MaxLines="2" 
                                                       Foreground="White"
                                                       FontSize="14"
                                                       FontWeight="Medium"
                                                       LineHeight="20"/>
                                            <TextBlock Text="{Binding Author}" 
                                                       Foreground="#AAAAAA" 
                                                       FontSize="13"
                                                       Margin="0,4,0,2"/>
                                            <TextBlock Foreground="#AAAAAA"
                                                       FontSize="13"
                                                       TextWrapping="NoWrap">
                                                <Run Text="{Binding Views}"/>
                                                <Run Text=" просмотров · "/>
                                                <Run Text="{Binding PublishedAt}"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Tabbar at the bottom -->
        <local:tabbar x:Name="tabbar" Grid.Row="2"/>
    </Grid>
</Page>