<Page
    x:Class="YouTube.Search"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:YouTube"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Black">

    <Page.Resources>
        <local:StringIsNullOrEmptyToVisibilityConverter x:Key="StringIsNullOrEmptyToVisibilityConverter"/>
    </Page.Resources>

    <Grid Background="Black">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Navigation Bar with Search -->
        <Grid Grid.Row="0" Background="Black" Height="56" Padding="8,8,8,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Search Box Container -->
            <Border Grid.Column="0" 
                    Background="#0F0F0F" 
                    BorderBrush="#303030"
                    BorderThickness="1"
                    Height="36"
                    VerticalAlignment="Center">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Search Icon -->
                    <SymbolIcon Grid.Column="0" 
                                Symbol="Find" 
                                Foreground="#717171" 
                                Margin="12,0,8,0"
                                VerticalAlignment="Center"/>
                    
                    <!-- Search TextBox -->
                    <TextBox x:Name="SearchTextBox"
                             Grid.Column="1"
                             PlaceholderText="Поиск на YouTube"
                             Background="Transparent"
                             BorderThickness="0"
                             Foreground="White"
                             FontSize="14"
                             Padding="0,8,0,8"
                             Margin="0"
                             VerticalAlignment="Stretch"
                             VerticalContentAlignment="Center"
                             HorizontalContentAlignment="Left"
                             Height="36"
                             TextChanged="SearchTextBox_TextChanged"
                             KeyUp="SearchTextBox_KeyUp"/>
                    
                    <!-- Clear Button -->
                    <Button Grid.Column="2"
                            x:Name="ClearButton"
                            Background="Transparent"
                            BorderThickness="0"
                            Width="32"
                            Height="32"
                            Visibility="Collapsed"
                            Click="ClearButton_Click">
                        <SymbolIcon Symbol="Clear" Foreground="#717171"/>
                    </Button>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Search Suggestions/History Panel -->
        <Border Grid.Row="1" 
                x:Name="SuggestionsPanel"
                Background="#0F0F0F"
                Visibility="Collapsed"
                BorderThickness="0"
                Margin="8,0,8,0">
            <ListView x:Name="SuggestionsList"
                      Background="Transparent"
                      SelectionMode="None"
                      IsItemClickEnabled="True"
                      ItemClick="SuggestionsList_ItemClick"
                      MaxHeight="400"
                      Padding="0">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Background="Transparent" 
                              Padding="16,8"
                              Height="40">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <SymbolIcon Grid.Column="0" 
                                        Symbol="Find" 
                                        Foreground="#717171" 
                                        Margin="0,0,12,0"
                                        VerticalAlignment="Center"/>
                            
                            <TextBlock Grid.Column="1"
                                       Text="{Binding}"
                                       Foreground="White"
                                       FontSize="14"
                                       VerticalAlignment="Center"/>
                            
                            <Button Grid.Column="2"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Width="32"
                                    Height="32"
                                    Visibility="Collapsed">
                                <SymbolIcon Symbol="Clear" Foreground="#717171"/>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Border>

        <!-- Search Results -->
        <ScrollViewer Grid.Row="2" 
                      Background="Black"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <ListView x:Name="SearchResultsGrid"
                      Background="Transparent"
                      SelectionMode="None"
                      IsItemClickEnabled="True"
                      ItemClick="VideosListView_ItemClick"
                      Padding="8,8,8,16">

                <!-- Items Panel Template for responsive grid -->
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid Orientation="Horizontal" 
                                     ItemWidth="360"
                                     MaximumRowsOrColumns="3"
                                     HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
                
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Vertical" 
                                  Margin="0,0,0,24" 
                                  Background="Black" 
                                  HorizontalAlignment="Center"
                                  Width="360">
                            <!-- Video Thumbnail -->
                            <Grid>
                                <Border Background="#1A1A1A" Height="202">
                                    <Image Source="{Binding thumbnail}" 
                                           Stretch="UniformToFill" 
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"/>
                                </Border>
                                
                                <!-- Duration overlay -->
                                <Border Background="#000000CC"
                                        Padding="6,2"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom"
                                        Margin="0,0,8,8"
                                        Visibility="{Binding duration, Converter={StaticResource StringIsNullOrEmptyToVisibilityConverter}}">
                                    <TextBlock Text="{Binding duration}" 
                                               Foreground="White" 
                                               FontSize="12" 
                                               FontWeight="Medium"/>
                                </Border>
                            </Grid>

                            <!-- Channel Thumbnail, Title, and Author -->
                            <Grid Margin="12,12,12,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Channel Thumbnail -->
                                <Border Width="36" Height="36" Background="#333333"
                                       Margin="0,0,12,0"
                                       Visibility="{Binding channel_thumbnail, Converter={StaticResource StringIsNullOrEmptyToVisibilityConverter}}">
                                    <Image Source="{Binding channel_thumbnail, FallbackValue='ms-appx:///Assets/placeholder.png'}"
                                           Stretch="UniformToFill"/>
                                </Border>
                                
                                <!-- Title and Author -->
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding title}"
                                             TextWrapping="Wrap"
                                             MaxLines="2"
                                             Foreground="White"
                                             FontSize="16"/>
                                    <TextBlock Text="{Binding author}"
                                             Foreground="Gray"
                                             FontSize="14"
                                             Margin="0,4,0,0"/>
                                    
                                    <!-- Views and Date -->
                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                        <TextBlock Text="{Binding Views}" 
                                                   Foreground="#AAAAAA" 
                                                   FontSize="12"/>
                                        <TextBlock Text=" просмотров • " 
                                                   Foreground="#AAAAAA" 
                                                   FontSize="12"/>
                                        <TextBlock Text="{Binding PublishedAt}" 
                                                   Foreground="#AAAAAA" 
                                                   FontSize="12"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </ScrollViewer>

        <!-- Loading Indicator -->
        <ProgressRing x:Name="LoadingRing"
                      Grid.Row="2"
                      IsActive="False"
                      Visibility="Collapsed"
                      Width="50"
                      Height="50"
                      Foreground="White"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>

        <!-- Error/No Data Message -->
        <StackPanel x:Name="ErrorPanel"
                    Grid.Row="2"
                    Visibility="Collapsed"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Margin="24">
            <Image Source="/Assets/failed_loading.png"
                   Width="96"
                   Height="96"
                   Margin="0,0,0,24"
                   Opacity="0.6"/>
            <TextBlock Text="Ничего не найдено"
                       Foreground="White"
                       FontSize="20"
                       FontWeight="Normal"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,8"/>
            <TextBlock Text="Попробуйте изменить запрос или использовать другие ключевые слова"
                       Foreground="#AAAAAA"
                       FontSize="14"
                       TextWrapping="Wrap"
                       TextAlignment="Center"
                       HorizontalAlignment="Center"
                       MaxWidth="320"
                       LineHeight="20"
                       Margin="0,0,0,24"/>
            <Border Background="#065FD4"
                    HorizontalAlignment="Center">
                <Button x:Name="RetryButton"
                        Content="Повторить"
                        Background="Transparent"
                        Foreground="White"
                        BorderThickness="0"
                        FontSize="14"
                        FontWeight="Medium"
                        Padding="16,10"
                        MinWidth="100"
                        HorizontalAlignment="Center"
                        Click="RetryButton_Click"/>
            </Border>
        </StackPanel>

        <!-- Tabbar at the bottom -->
        <local:tabbar x:Name="tabbar" Grid.Row="3"/>
    </Grid>
</Page>
